<p align="center">
  <img src="src/assets/logo-light.jpg" alt="BARQ Ai Logo" width="120" />
</p>

<h1 align="center">โก BARQ Ai โ ุจุฑู Ai</h1>

<p align="center">
  <strong>ุฃูู ููุตุฉ ุนุฑุจูุฉ ูุจูุงุก ุงูููุงูุน ุจุงูุฐูุงุก ุงูุงุตุทูุงุนู</strong><br/>
  Arabic-First AI Website Builder โ Made for Saudi Arabia ๐ธ๐ฆ
</p>

<p align="center">
  <a href="https://barqai.site">๐ ุงููููุน ุงูุฑุณูู</a> โข
  <a href="#-ุงููููุฒุงุช">โจ ุงููููุฒุงุช</a> โข
  <a href="#-ุงูุชูููุงุช-ุงููุณุชุฎุฏูุฉ">๐ ุงูุชูููุงุช</a> โข
  <a href="#%EF%B8%8F-ุทุฑููุฉ-ุงูุนูู-ุจุงูุชูุตูู">โ๏ธ ุทุฑููุฉ ุงูุนูู</a>
</p>

---

## ๐ ูุจุฐุฉ ุนู ุงููุดุฑูุน

**BARQ Ai** ูู ููุตุฉ SaaS ูุชูุงููุฉ ุชูููู ุงููุณุชุฎุฏููู ูู ุจูุงุก ููุงูุน ููุจ ุงุญุชุฑุงููุฉ ุจุงููุงูู ุนู ุทุฑูู ุงููุญุงุฏุซุฉ ุจุงููุบุฉ ุงูุนุฑุจูุฉ (ุงูููุฌุฉ ุงูุณุนูุฏูุฉ). ุงูููุตุฉ ุชุณุชุฎุฏู ูุธุงู **ุฐูุงุก ุงุตุทูุงุนู ูุฒุฏูุฌ** (Dual-AI) ููุตู ุจูู ุงูุชุฎุทูุท ูุงูุชูููุฐ ูุชุญููู ุฃุนูู ุฌูุฏุฉ ููููุฉ.

> ๐ก **ุงูููุฑุฉ:** ุชูุชุจ ูุด ุชุจุบู ุจุงูุนุฑุจู โ ุงูุฐูุงุก ุงูุงุตุทูุงุนู ูุฎุทุท ููุจูู ุงููููุน ูุงูู ูุฏุงูู ูุญุธูุงู.

---

## โจ ุงููููุฒุงุช

### ๐ง ูุธุงู ุงูุฐูุงุก ุงูุงุตุทูุงุนู ุงููุฒุฏูุฌ (Dual-AI Engine)
- **ุงููุดุฑู (Supervisor โ Gemini 2.5 Flash):** ูุชููู ููู ุทูุจู ุจุงูุนุฑุจูุ ูุณุฃู ุฃุณุฆูุฉ ุชูุถูุญูุฉุ ููุจูู ุฎุทุฉ ุชูููุฉ ููุตูุฉ ุจุงูุฅูุฌููุฒูุฉ
- **ุงููุจุฑูุฌ (Programmer โ LLaMA 3.3 70B via Groq):** ูููุฐ ุงูุฎุทุฉ ุงูุชูููุฉ ูููููุฏ ูููุงุช React/Tailwind ุจุฌูุฏุฉ ุฅูุชุงุฌูุฉ
- **ุดูุงููุฉ ูุงููุฉ:** ุชูุฏุฑ ุชุดูู ูู ูุฑุญูุฉ (ุชูููุฑ โ ุชุฎุทูุท โ ุชุณููู โ ุชูููุฐ โ ูุฑุงุฌุนุฉ) ูุญุธูุงู ูุน ุฃููููุดูุงุช ุณูุณุฉ

### ๐ ูุธุงู ุงููุฑุงุฌุนุฉ ูุงูุฅุตูุงุญ ุงูุชููุงุฆู (3 ุทุจูุงุช)

#### ุงูุทุจูุฉ 1: ุงููุฑุงุฌุน ุงูุชููุงุฆู (`barq-reviewer`)
- ุจุนุฏ ูู ุจูุงุก ูุชู ุฅุฑุณุงู ุงููููุงุช ุงูููููุฏุฉ ุฅูู Gemini ูููุฑุงุฌุนุฉ
- ูุชุญูู ูู: ุงูุชูุงู ุงููููุงุชุ ุฏุนู RTLุ ุฎุท Cairoุ ุงููุญุชูู ุงูุนุฑุจูุ ุงูุชุตููู ุงููุชุฌุงูุจ
- ุงููุชูุฌุฉ: `approved` โ ุฃู `needs_fix` ๐ง
- ุฅุฐุง `needs_fix`: ููููุฏ `fix_prompt` ููุนูุฏ ุฅุฑุณุงูู ูููุจุฑูุฌ ุชููุงุฆูุงู
- **ุญุฏ ุฃูุตู ูุญุงููุชูู** ูููุน ุงูุญููุงุช ุงููุงููุงุฆูุฉ

#### ุงูุทุจูุฉ 2: ุงูุฅุตูุงุญ ุงูุฐูู (`barq-fixer`)
- ููุชุดู ุฃุฎุทุงุก Runtime ูู ุงููุนุงููุฉ ุนุจุฑ `PreviewErrorBoundary`
- ูุญูู `errorMessage` ู `componentStack` ูุน ุณูุงู VFS ุงููุงูู
- ููุชุฑุญ ุนูููุงุช VFS (ุฅูุดุงุก/ุชุนุฏูู/ุญุฐู ูููุงุช) ุนุจุฑ ุฃุฏุงุฉ `suggest_vfs_fixes`
- ุงููุณุชุฎุฏู ููุจู ุฃู ูุฑูุถ ุงูุฅุตูุงุญ

#### ุงูุทุจูุฉ 3: ุญุฏูุฏ ุงูุฎุทุฃ (Error Boundary)
- ูููู `PreviewErrorBoundary` (React Class Component) ููุชูุท ุฃุฎุทุงุก ุงูุนุฑุถ
- ูุนุฑุถ ุฒุฑ **"ุฅุนุงุฏุฉ ุงููุญุงููุฉ"** ูุฒุฑ **"ุฅุตูุงุญ ุชููุงุฆู โก"**
- ุฒุฑ ุงูุฅุตูุงุญ ูุณุชุฏุนู `barq-fixer` ูุจุงุดุฑุฉ

### ๐ฌ ูุญุงุฏุซุฉ ุฐููุฉ ุจุงูุนุฑุจู
- **ูุถุน ุงูุชุฎุทูุท (Planning Mode):** ุงูุฐูุงุก ุงูุงุตุทูุงุนู ูุณุฃู ุฃุณุฆูุฉ ุชูุถูุญูุฉ ูุจู ุงูุจูุงุก
- **ููุฌุฉ ุณุนูุฏูุฉ ุทุจูุนูุฉ:** System Prompt ูุฎุตุต ุจุงูููุฌุฉ ุงูุณุนูุฏูุฉ
- **ุฒุฑ "ุงุจุฏุฃ ุงูุจูุงุก โก":** ูุง ูุจุฏุฃ ุงูุชูููุฏ ุฅูุง ุนูุฏ ุชุฃููุฏ ุงููุณุชุฎุฏู ุจูููุฉ ูุซู "ุงุจุฏุฃ" ุฃู "ููุง" ุฃู "ููุฐ"
- **ุณุฌู ูุญุงุฏุซุงุช ูุญููุธ:** ูู ุงูุฑุณุงุฆู ุชูุญูุธ ูู ุฌุฏูู `chat_messages` ูุฑุชุจุทุฉ ุจุงููุดุฑูุน

### ๐ง ุชุนุฏูู ุชูุฑุงุฑู ุฐูู (Context-Aware Refinement)
- ูุฑุณู ุฃูู 800 ุญุฑู ูู ูู ููู (+ ุขุฎุฑ 300 ุญุฑู ูููููุงุช ุงููุจูุฑุฉ) ูุณูุงู
- ุงูุฐูุงุก ูุญูู ุงููููุงุช ุงูููุฌูุฏุฉ ููุนุฏู ุงููุทููุจ ููุท
- ูุฏุนู ุฅุฌุฑุงุกุงุช: `create` (ุฅูุดุงุก) ู `update` (ุชุนุฏูู) ู `delete` (ุญุฐู)
- ูุฎุทุท ุงูุงุนุชูุงุฏูุงุช (Dependency Graph) ูุญุฏุฏ ุงูุนูุงูุงุช ุจูู ุงูููููุงุช

### ๐ฑ ูุนุงููุฉ ูุญุธูุฉ ูุชุฌุงูุจุฉ
- **ูุญุฑู ุงููุนุงููุฉ (`preview-builder.ts`):** ูุญููู JSX ุฅูู HTML ูุธูู:
  - ูุฒูู `import`/`export`/`function` declarations
  - ูุญููู `className` โ `class`
  - ูุญููู `style={{...}}` ุฅูู inline CSS
  - ูุฒูู Event Handlers (`onClick`, `onChange`...)
  - ูุฒูู `ref`, `key`, ุชุนุจูุฑุงุช JSX ุงูุฏููุงููููุฉ
  - ูุฏุนู `.map()`, ternary operators, `&&` conditions
- **ุชุฌููุน ุงูููููุงุช:** ูุจุญุซ ุนู `App.tsx` ููุณุชุจุฏู `<Header />` ุจูุญุชูู `Header.tsx` ุงููุนูู
- **ุชุฑุชูุจ ุฐูู:** ุฅุฐุง ูู ููุฌุฏ App.tsx ูุฑุชุจ: Header โ Hero โ (ุจุงูู ุงูููููุงุช) โ Contact โ Footer
- **ุงููุงูุจ ุงูููุงุฆู:** HTML5 ูุงูู ูุน Tailwind CDN + ุฎุท Cairo + RTL
- ุชุจุฏูู ุจูู ุฃุญุฌุงู ุงูุดุงุดุงุช: **ุฌูุงู (375px)** ยท **ุชุงุจูุช (768px)** ยท **ุณุทุญ ููุชุจ**

### ๐ ูุธุงู ุงููููุงุช ุงูุงูุชุฑุงุถู (Virtual File System โ VFS)

#### ุงูุจููุฉ ุงูุชูููุฉ:
```typescript
interface VFSFile {
  name: string;        // ูุณุงุฑ ุงูููู (e.g., "Header.tsx")
  content: string;     // ูุญุชูู ุงูููู ุงููุงูู
  language: 'tsx' | 'css' | 'html' | 'json' | 'ts' | 'js';
  version?: number;    // ุฑูู ุงูุฅุตุฏุงุฑ
}

interface VFSOperation {
  path: string;
  content?: string;
  action: 'create' | 'update' | 'delete';
}

interface VFSVersionSnapshot {
  version: number;
  timestamp: string;
  files: VFSFile[];
  message: string;     // ูุตู ุงูุชุบููุฑ
}
```

#### ุงููููุฒุงุช:
- **ุชุงุฑูุฎ ุงูุฅุตุฏุงุฑุงุช:** ูู ุชุบููุฑ ููุญูุธ ูู Snapshot ูุงูู
- **ุชุฑุงุฌุน/ุฅุนุงุฏุฉ (Undo/Redo):** ุงูุชููู ุจูู ุงูุฅุตุฏุงุฑุงุช ุงูุณุงุจูุฉ
- **ุญูุธ ุชููุงุฆู:** ููุญูุธ ูู ุนููุฏ `vfs_data` (JSON) ุจุฌุฏูู `projects`
- **ุงุณุชุนุฑุถ ุงูููุฏ:** ูุณุชุนุฑุถ ูููุงุช ูุงูู ูู ุงููุชุตูุญ

### ๐จ ุชุตููู ุงุญุชุฑุงูู ุชููุงุฆู

#### ูุธุงู ุงูุฃููุงู ุงูุฐูู:
| ููุน ุงููุดุฑูุน | ุงูููู ุงูุฃุณุงุณู | ุงูููู ุงูุซุงููู | ููู ุงูุชูููุฒ |
|-------------|---------------|---------------|-------------|
| ูุทุงุนู/ุทุนุงู | amber-600 | stone-800 | amber-400 |
| ุชูููุฉ/ุจุฑูุฌูุงุช | blue-600 | slate-800 | cyan-400 |
| ุตุญุฉ/ุทุจ | emerald-600 | slate-700 | green-400 |
| ุชุนููู | violet-600 | slate-800 | purple-400 |
| ุนูุงุฑุงุช | sky-600 | gray-800 | sky-400 |
| ุฃุฒูุงุก/ุฌูุงู | rose-500 | gray-800 | pink-400 |
| ุนุงู/ุดุฑูุงุช | slate-700 | blue-600 | blue-400 |

#### ูุนุงููุฑ ุงูุชุตููู:
- **Hero Section:** `min-h-[90vh]` ูุน ุชุฏุฑุฌุงุช ูุฃุดูุงู ุฒุฎุฑููุฉ
- **ุงูุฃูุณุงู:** padding `py-20 md:py-28 lg:py-32`
- **ุงูุฃุฒุฑุงุฑ ุงูุฃุณุงุณูุฉ:** `px-8 py-4 rounded-xl font-bold shadow-lg hover:-translate-y-0.5 transition-all`
- **ุงูุจุทุงูุงุช:** `bg-white rounded-2xl p-8 shadow-sm hover:shadow-xl hover:-translate-y-1 transition-all`
- **ุงูุนูุงููู:** `text-4xl sm:text-5xl md:text-6xl lg:text-7xl font-extrabold`

### ๐๏ธ ุจูุงุก ูุดุงุฑูุน ูุงููุฉ (Full-Stack Scaffolding)

ุงูุญุฏ ุงูุฃุฏูู **6 ูููุงุช** ููู ูุดุฑูุน:

| ุงูููู | ุงููุญุชูู | ูุชุทูุจุงุช |
|-------|---------|---------|
| `styles.css` | CSS variables, animations (fadeInUp, fadeIn, slideInRight), glass-effect | ุฃููููุดูุงุช + ุชุฏุฑุฌุงุช |
| `Header.tsx` | Sticky nav, logo, links, CTA, mobile hamburger | glass-effect + border-b |
| `Hero.tsx` | Gradient/light background, heading, subtitle, 2 buttons, stats | min-h-[90vh] |
| `Services.tsx` | Badge + heading, 3-column grid with icon cards | bg-gray-50 |
| `About.tsx` | 2-column: text with bullets + visual gradient/pattern | โ |
| `Contact.tsx` | Gradient bg, white form card, contact info | โ |
| `Footer.tsx` | bg-gray-900, 3-4 columns, social icons, copyright | โ |
| `App.tsx` | `<div dir="rtl" lang="ar" style={{fontFamily: 'Cairo'}}>` wrapping all | ููุทุฉ ุงูุฏุฎูู |

### ๐ค ุชุตุฏูุฑ GitHub
- OAuth App ูุน callback URL: `https://barqai.site/auth/github/callback`
- ูุตุฏูุฑ ูุงูู ูููู ุงููุดุฑูุน: `package.json`, `vite.config.ts`, `.env`, ุฅูุฎ
- Edge Function ูุฎุตุตุฉ (`github-export`) ุชุฏุนู:
  - `get_auth_url` โ ุฑุงุจุท ุงููุตุงุฏูุฉ
  - `exchange_code` โ ุชุจุงุฏู ุงูููุฏ
  - `create_repo` โ ุฅูุดุงุก Repository
  - `push_files` โ ุฑูุน ุงููููุงุช

### ๐ฆ ุชุตุฏูุฑ ZIP
- ุชุญููู ุงููุดุฑูุน ูููู ูุถุบูุท ุฌุงูุฒ ููุชุดุบูู

### ๐ค ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู ูุงููุดุงุฑูุน
- ุชุณุฌูู ุฏุฎูู ุขูู ุจุงูุจุฑูุฏ ุงูุฅููุชุฑููู (Supabase Auth)
- ููุญุฉ ูุดุงุฑูุน ูุฅุฏุงุฑุฉ ุฌููุน ุงููุดุงุฑูุน ุงูุณุงุจูุฉ
- ุญูุธ ุชููุงุฆู ูุณุชูุฑ ูููุดุฑูุน ูุงููุญุงุฏุซุงุช

### ๐ผ ูููุฐุฌ SaaS ูุชูุงูู
- ุซูุงุซ ุจุงูุงุช: **ุฃุณุงุณู** ยท **ุงุญุชุฑุงูู** ยท **ูุคุณุณุงุช**
- ูุธุงู ุญุฏูุฏ ุงุณุชุฎุฏุงู ููููุฉ:
  - Planner: 50 ุทูุจ/ููู
  - Builder: 30 ุทูุจ/ููู
  - Reviewer: 30 ุทูุจ/ููู
- ููู ุชุนุฑูู ุงูุนูุงูุฉ ุงูุชุฌุงุฑูุฉ (Brand Profile): ุงุณูุ ุดุนุงุฑุ ุฃููุงู

### ๐ ุฃูุงู ุนูู ูุณุชูู ุงููุคุณุณุงุช
- ูุตุงุฏูุฉ JWT ูู ูู Edge Function
- `check_and_increment_usage` โ ุฏุงูุฉ PL/pgSQL ููุญุต ุงูุญุฏูุฏ ูุฒูุงุฏุฉ ุงูุนุฏุงุฏ ุฐุฑูุงู (Atomic)
- ุณูุงุณุงุช RLS ุนูู ุฌููุน ุงูุฌุฏุงูู
- Service Role Key ููุนูููุงุช ุงูุฅุฏุงุฑูุฉ ููุท

### ๐ฅ๏ธ ูุงุฌูุฉ ุงููุณุชุฎุฏู โ ThinkingEngine

ูููู `ThinkingEngine.tsx` ูุนุฑุถ ุฎุท ุงูุฃูุจูุจ ุจุงููุงูู:

```
[๐ง ุชูููุฑ] โโโ [๐ ุชุฎุทูุท] โโโ [๐ ุชุณููู] โโโ [๐๏ธ ุชูููุฐ] โโโ [๐ ูุฑุงุฌุนุฉ]
```

#### ุงููุฑุงุญู (PipelineStage):
```typescript
type PipelineStage = 'thinking' | 'planning' | 'handoff' | 'building' | 'reviewing' | 'done';
```

| ุงููุฑุญูุฉ | ุงูุฃููููุฉ | ุงูููู | ุงููุตู |
|---------|---------|-------|-------|
| `thinking` | Brain | purple-400 | ุจุฑู ูููุฑ... |
| `planning` | Zap | accent (gold) | ูุฎุทุท ุงูุจููุฉ... |
| `handoff` | ArrowLeftRight | blue-400 | ูุฑุณู ุงูุชุนูููุงุช ูููุจุฑูุฌ... |
| `building` | Hammer | amber-400 | ุงููุจุฑูุฌ ูููุฐ... |
| `reviewing` | ShieldCheck | emerald-400 | ุงููุฑุงุฌุน ูุชุญูู... |
| `done` | Sparkles | green-400 | ุงูุชูู! โจ |

#### ุงูุฃููููุดูุงุช:
- **Ping Effect:** ูุจุถ ุนูู ุงูุฃููููุฉ ุงููุดุทุฉ
- **Stage Transition:** ุชุฃุซูุฑ scale + fade ุนูุฏ ุงูุงูุชูุงู ุจูู ุงููุฑุงุญู
- **Connector Lines:** ุฎุทูุท ูุชุญุฑูุฉ ุชููุฃ ุชุฏุฑูุฌูุงู ูุน ุชูุฏู ุงููุฑุงุญู
- **Typing Dots:** ููุงุท ูุชุญุฑูุฉ ุจุฌุงูุจ ุงููุฑุญูุฉ ุงููุดุทุฉ
- **Staggered Entry:** ุธููุฑ ูุชุชุงุจุน ููุนูุงุตุฑ ุจูุงุฑู `60ms`
- **Handoff Panel:** ูุนุฑุถ ุงูุชุนูููุงุช ุงูุชูููุฉ ุจุฎุท `mono` ูู ุฅุทุงุฑ ุฃุฒุฑู

### ๐ฑ ุชุตููู ูุชุฌุงูุจ ุจุงููุงูู
- **ุณุทุญ ุงูููุชุจ:** ููุญุงุช ูุงุจูุฉ ูุชุบููุฑ ุงูุญุฌู (`react-resizable-panels`)
- **ุงูุฌูุงู:** ุนุฑุถ ููุก ุงูุดุงุดุฉ ูุน ุดุฑูุท ุชููู ุณููู
- ุชุจุฏูู ุจูู: **ุงููุญุงุฏุซุฉ** ยท **ุงููุนุงููุฉ** ยท **ุงูููุฏ**

---

## ๐ ุงูุชูููุงุช ุงููุณุชุฎุฏูุฉ

### ุงููุงุฌูุฉ ุงูุฃูุงููุฉ (Frontend)

| ุงูุชูููุฉ | ุงูุฅุตุฏุงุฑ | ุงูุงุณุชุฎุฏุงู |
|---------|---------|-----------|
| **React** | 18.3 | ุฅุทุงุฑ ุงูุนูู ุงูุฑุฆูุณู |
| **TypeScript** | โ | ูุธุงู ุงูุฃููุงุน ุงูุซุงุจุช |
| **Vite** | โ | ุฃุฏุงุฉ ุงูุจูุงุก (HMR ุณุฑูุน) |
| **Tailwind CSS** | โ | Utility-first CSS framework |
| **Shadcn/UI** | โ | ููููุงุช Radix UI ูุฎุตุตุฉ |
| **React Router** | v6 | ุงูุชูุฌูู ูุน AuthGuard |
| **TanStack React Query** | v5 | ุฅุฏุงุฑุฉ ุญุงูุฉ ุงูุจูุงูุงุช ูุงูุชุฎุฒูู ุงููุคูุช |
| **React Resizable Panels** | โ | Split panels ููุจููุฏุฑ |
| **Lucide React** | โ | ููุชุจุฉ ุฃููููุงุช SVG |
| **Sonner** | โ | ุฅุดุนุงุฑุงุช Toast ุนุฑุจูุฉ |
| **Recharts** | โ | ุงูุฑุณูู ุงูุจูุงููุฉ |
| **Zod** | โ | ุงูุชุญูู ูู ุงูุจูุงูุงุช |
| **React Hook Form** | โ | ุฅุฏุงุฑุฉ ุงูููุงุฐุฌ |
| **date-fns** | โ | ูุนุงูุฌุฉ ุงูุชูุงุฑูุฎ |
| **class-variance-authority** | โ | Component variants |
| **tailwind-merge** | โ | ุฏูุฌ Tailwind classes |
| **tailwindcss-animate** | โ | ุฃููููุดูุงุช Tailwind |
| **cmdk** | โ | Command palette |
| **vaul** | โ | Drawer component |
| **embla-carousel-react** | โ | Carousel |
| **input-otp** | โ | OTP input |

### ุงูุฎูููุฉ (Backend)

| ุงูุชูููุฉ | ุงูุงุณุชุฎุฏุงู |
|---------|-----------|
| **Supabase** | BaaS: ูุงุนุฏุฉ ุจูุงูุงุช + ูุตุงุฏูุฉ + ุชุฎุฒูู |
| **PostgreSQL** | ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงูุนูุงุฆููุฉ |
| **Edge Functions (Deno)** | 5 ุฏูุงู ุณุญุงุจูุฉ ูุชุฎุตุตุฉ |
| **Row Level Security (RLS)** | ุญูุงูุฉ ุงูุจูุงูุงุช |
| **PL/pgSQL** | `check_and_increment_usage()` |
| **JWT Authentication** | ูุตุงุฏูุฉ ูู ุทูุจ |

### ููุงุฐุฌ ุงูุฐูุงุก ุงูุงุตุทูุงุนู (AI Models)

| ุงููููุฐุฌ | ุงููุฒูุฏ | ุงูุฏูุฑ | ุงูู Endpoint |
|---------|--------|------|-------------|
| **Gemini 2.5 Flash** | Google | ุงููุดุฑู (Planner) | `generativelanguage.googleapis.com/v1beta/openai/chat/completions` |
| **Gemini 2.5 Flash** | Google | ุงููุฑุงุฌุน (Reviewer) | ููุณ ุงูู endpoint |
| **Gemini 2.5 Flash** | Google | ุงููุตูุญ (Fixer) | ููุณ ุงูู endpoint |
| **LLaMA 3.3 70B Versatile** | Groq | ุงููุจุฑูุฌ (Builder) | `api.groq.com/openai/v1/chat/completions` |
| **LLaMA 3.3 70B Versatile** | Groq | Fallback ูุฌููุน ุงููุญุฑูุงุช | ููุณ ุงูู endpoint |

### ุงูุจููุฉ ุงูุชุญุชูุฉ (Infrastructure)

| ุงูุชูููุฉ | ุงูุงุณุชุฎุฏุงู |
|---------|-----------|
| **Lovable Cloud** | ุงูุงุณุชุถุงูุฉ ูุงููุดุฑ |
| **SSE (Server-Sent Events)** | ุงูุจุซ ุงููุญุธู ุซูุงุฆู ุงูุงุชุฌุงู |
| **GitHub OAuth App** | ุชุตุฏูุฑ ุงููุดุงุฑูุน |
| **Tailwind CDN** | ุชุญููู Tailwind ูู ุงููุนุงููุฉ |
| **Google Fonts CDN** | ุฎุท Cairo ูู ุงููุนุงููุฉ |

---

## โ๏ธ ุทุฑููุฉ ุงูุนูู ุจุงูุชูุตูู

### ุงูุฎุทูุฉ 1: ุงููุณุชุฎุฏู ูุฑุณู ุฑุณุงูุฉ

```
"ุฃุจุบู ูููุน ููุทุนู ุณุนูุฏู"
```

ุงูุฑุณุงูุฉ ุชูุญูุธ ูู `chat_messages` ูุชูุฑุณู ูุน ุณูุงู VFS ุฅูู `barq-planner`.

### ุงูุฎุทูุฉ 2: ุงููุดุฑู ูููุฑ (barq-planner)

**System Prompt:**
```
ุฃูุช "ุจุฑู" โก โ ูููุฏุณ ุญููู ุฐูุงุก ุงุตุทูุงุนู ุฎุจูุฑ ูู Barq AI.
- ุชุชููู ุจุงูููุฌุฉ ุงูุณุนูุฏูุฉ ุจุดูู ุทุจูุนู ููุญุชุฑู
- ุชุญูู ุทูุจุงุช ุงููุณุชุฎุฏู ูุชุญูููุง ุฅูู ุฎุทุฉ ุจูุงุก ุชูุฑุงุฑูุฉ
- ุงูุชุฎุทูุท ูุจู ุงูุชูููุฐ: ูุง ุชุณุชุฏุนู ุฃุฏุงุฉ prepare_build_prompt ุฅูุง ุจุนุฏ ููุงููุฉ ุงููุณุชุฎุฏู
```

**ุงูุฃุฏุงุฉ ุงููุชุงุญุฉ:** `prepare_build_prompt`
```json
{
  "build_prompt": "English technical prompt for builder...",
  "summary_ar": "ููุฎุต ุนุฑุจู ูููุณุชุฎุฏู",
  "project_name": "ุงุณู ุงููุดุฑูุน",
  "dependency_graph": {
    "nodes": [{"id": "Header.tsx", "action": "create"}, ...],
    "edges": [{"from": "App.tsx", "to": "Header.tsx"}, ...]
  }
}
```

**ุงูุณููู:**
- ุฅุฐุง VFS ูุงุฑุบ โ ูุณุฃู ุนู ุงูุชูุงุตูู (ุจูุงุก ุฌุฏูุฏ)
- ุฅุฐุง VFS ููุฌูุฏ โ ูุญูู ุงููููุงุช ูููุชุฑุญ ุชุนุฏููุงุช ูุณุชูุฏูุฉ
- ููุชุธุฑ ูููุฉ ุชุฃููุฏ ("ุงุจุฏุฃ", "ููุง", "ููุฐ") ูุจู ุงุณุชุฏุนุงุก ุงูุฃุฏุงุฉ

### ุงูุฎุทูุฉ 3: ุงูุชุณููู (Handoff)

ุงููุดุฑู ููููุฏ `build_prompt` ุจุงูุฅูุฌููุฒูุฉ ูููุฑุณู ูุญุฏุซ SSE:
```json
{"event": "build_ready", "prompt": "...", "summary": "...", "dependencyGraph": {...}}
```

UI ูุนุฑุถ ุงูุชุนูููุงุช ูู ุฅุทุงุฑ ุฃุฒุฑู ุจุฎุท `mono` ูุน ุนููุงู "ุชุนูููุงุช ุงููุดุฑู โ ุงููุจุฑูุฌ".

### ุงูุฎุทูุฉ 4: ุงููุจุฑูุฌ ูููุฐ (barq-chat)

**System Prompt:** (106 ุณุทุฑ) ูุดูู:
- ููุงุนุฏ ุตุงุฑูุฉ: ุนุฑุจู 100%, RTL, Cairo font, SVG inline icons
- ูุธุงู ุฃููุงู ุญุณุจ ููุน ุงููุดุฑูุน
- ูุนุงููุฑ ุงูุชุตููู: spacing, typography, buttons, cards
- ุงูุญุฏ ุงูุฃุฏูู 6 ูููุงุช
- ูุถุน ุงูุชุนุฏูู: ููุฑุฃ `EXISTING FILES` ููุนุฏู ุงููุทููุจ ููุท

**ุงูุฃุฏุงุฉ:** `generate_website`
```json
{
  "thought_process": ["ุฎุทูุฉ 1...", "ุฎุทูุฉ 2..."],
  "design_personality": "formal|creative|minimalist|bold",
  "vfs_operations": [
    {"path": "Header.tsx", "action": "create", "content": "...", "language": "tsx"}
  ],
  "user_message": "ุชู ุจูุงุก ุงููููุน ุจูุฌุงุญ! โก",
  "css_variables": {"primary_color": "...", "border_radius": "..."}
}
```

**ุงูุจุซ (Streaming):**
```
thinking_start โ thinking_step ร N โ file_start โ file_done ร N โ done
```

### ุงูุฎุทูุฉ 5: ุชุญุฏูุซ VFS

ุงููููุงุช ุชูุทุจู ุนูู VFS ุนุจุฑ `applyVFSOperations`:
1. ููุงุฑูุฉ ูู `path` ุจุงููููุงุช ุงูููุฌูุฏุฉ
2. ุชูููุฐ create/update/delete
3. ุฅูุดุงุก VFS Snapshot ุฌุฏูุฏ
4. ุญูุธ ูู Supabase (`projects.vfs_data`)

### ุงูุฎุทูุฉ 6: ุจูุงุก ุงููุนุงููุฉ (Preview Engine)

```typescript
buildPreviewHTML(files) โ HTML string โ iframe.srcdoc
```

**ุฎุทูุงุช ุงูุชุญููู:**
1. ูุตู ูููุงุช CSS ุนู TSX
2. ุงูุจุญุซ ุนู `App.tsx` ููููู ุฑุฆูุณู
3. ุชุญููู ูู ูููู ูู JSX ุฅูู HTML ูุธูู (`jsxToHTML`)
4. ุงุณุชุจุฏุงู `<Header />` ูู App.tsx ุจูุญุชูู Header.tsx
5. ุชุฌููุน CSS ูู `<style>` tag
6. ุฅูุชุงุฌ HTML5 ูุงูู ูุน Tailwind CDN + Cairo font

### ุงูุฎุทูุฉ 7: ุงููุฑุงุฌุนุฉ ุงูุชููุงุฆูุฉ (barq-reviewer)

ููุฑุณู `build_prompt` + ุงููููุงุช ุงูููููุฏุฉ ุฅูู Gemini:
```json
{
  "status": "needs_fix",
  "summary_ar": "ูุฌุฏุช 3 ูุดุงูู...",
  "issues": [
    {"file": "Footer.tsx", "issue": "ูุญุชูู ุบูุฑ ุนุฑุจู", "fix_instruction": "..."}
  ],
  "fix_prompt": "English prompt to fix all issues..."
}
```

**ุฅุฐุง `needs_fix`:**
- `fixAttemptsRef` ูุชุชุจุน ุนุฏุฏ ุงููุญุงููุงุช
- ุฅุฐุง < 2: ูุนูุฏ ุฅุฑุณุงู `fix_prompt` ุฅูู ุงููุดุฑู โ ุงููุจุฑูุฌ โ ุงููุฑุงุฌุน
- ุฅุฐุง >= 2: ูุชููู ููุนุฑุถ ุงููุดุงูู ูููุณุชุฎุฏู

**ุฅุฐุง `approved`:**
- ูุนุฑุถ โ ูุน ููุฎุต ุนุฑุจู
- ูุฎุชูู ุจุนุฏ 4 ุซูุงูู

---

## ๐ ูุธุงู ุงูููุงุชูุญ ูุงูู Failover

### ุงุณุชุฑุงุชูุฌูุฉ ุงูุชุจุฏูู (High Availability):

```
ุทูุจ ุฌุฏูุฏ
    โ
    โผ
โโโโโโโโโโโโโโโโโโโ
โ  Gemini Key #1  โ โ ูุฌุฑุจ ุฃููุงู
โโโโโโโโโโฌโโโโโโโโโ
         โ 429 Rate Limit?
         โผ
โโโโโโโโโโโโโโโโโโโ
โ  Gemini Key #2  โ โ ูุฌุฑุจ ุซุงููุงู
โโโโโโโโโโฌโโโโโโโโโ
         โ 429 Rate Limit?
         โผ
โโโโโโโโโโโโโโโโโโโ
โ   Groq Key #1   โ โ Fallback
โโโโโโโโโโฌโโโโโโโโโ
         โ 429?
         โผ
โโโโโโโโโโโโโโโโโโโ
โ   Groq Key #2   โ
โโโโโโโโโโฌโโโโโโโโโ
         โ 429?
         โผ
โโโโโโโโโโโโโโโโโโโ
โ   Groq Key #3   โ
โโโโโโโโโโฌโโโโโโโโโ
         โ ูุดู ุงููู?
         โผ
  โ "ุฌููุน ุงูููุงุชูุญ ูุตูุช ููุญุฏ"
```

### ุงูููุงุชูุญ ุงููุทููุจุฉ (Supabase Secrets):

| ุงูููุชุงุญ | ุงููุญุฑู | ููุงุญุธุงุช |
|---------|--------|---------|
| `GEMINI_API_KEY` | Planner, Reviewer, Fixer | ุฃุณุงุณู |
| `GEMINI_API_KEY_2` | Fallback | ุงุญุชูุงุทู |
| `GROQ_API_KEY` | Builder + Fallback | ุฃุณุงุณู |
| `GROQ_API_KEY_2` | Fallback | ุงุญุชูุงุทู |
| `GROQ_API_KEY_3` | Fallback | ุงุญุชูุงุทู |

---

## ๐ก ุจุฑูุชูููู ุงูุงุชุตุงู (SSE Events)

ุฌููุน ุงูุงุชุตุงูุงุช ุจูู Frontend ู Edge Functions ุชุชู ุนุจุฑ **Server-Sent Events**:

### ุฃุญุฏุงุซ barq-planner:
| ุงูุญุฏุซ | ุงูุจูุงูุงุช | ุงููุตู |
|-------|---------|-------|
| `message_delta` | `{content}` | ูุต ุชุฏุฑูุฌู ูู ุงููุดุฑู |
| `build_ready` | `{prompt, summary, projectName, dependencyGraph}` | ุฎุทุฉ ุงูุจูุงุก ุฌุงูุฒุฉ |
| `done` | โ | ุงูุชูู ุงูุจุซ |

### ุฃุญุฏุงุซ barq-chat (Builder):
| ุงูุญุฏุซ | ุงูุจูุงูุงุช | ุงููุตู |
|-------|---------|-------|
| `thinking_start` | โ | ุจุฏุงูุฉ ุงูุชูููุฑ |
| `thinking_step` | `{step}` | ุฎุทูุฉ ุชูููุฑ ูุงุญุฏุฉ |
| `file_start` | `{path, action, language}` | ุจุฏุงูุฉ ุชูููุฏ ููู |
| `file_done` | `{path, content}` | ููู ููุชูู |
| `message_delta` | `{content}` | ุฑุณุงูุฉ ูุตูุฉ |
| `done` | โ | ุงูุชูู ุงูุจุซ |

### ุฃุญุฏุงุซ barq-fixer:
| ุงูุญุฏุซ | ุงูุจูุงูุงุช | ุงููุตู |
|-------|---------|-------|
| `fix_ready` | `{operations, summary}` | ุงูุชุฑุงุญุงุช ุงูุฅุตูุงุญ |
| `done` | โ | ุงูุชูู ุงูุจุซ |

### ูุนุงูุฌุฉ SSE ูู Frontend (`barq-api.ts`):
- **Timeout:** 45 ุซุงููุฉ ุจุฏูู ูุดุงุท โ ุฅูุบุงุก
- **Line-by-line parsing:** ูุนุงูุฌุฉ ุณุทุฑ ุจุณุทุฑ (ููุณ `\n\n`)
- **Final flush:** ูุนุงูุฌุฉ ุฃู ุจูุงูุงุช ูุชุจููุฉ ูู Buffer
- **Error recovery:** ุชุฎุทู ุฃุณุทุฑ JSON ุบูุฑ ุตุงูุญุฉ

---

## ๐๏ธ ูููู ูุงุนุฏุฉ ุงูุจูุงูุงุช

| ุงูุฌุฏูู | ุงูุฃุนูุฏุฉ ุงูุฑุฆูุณูุฉ | RLS | ุงููุตู |
|--------|-----------------|-----|-------|
| `profiles` | `user_id`, `display_name`, `avatar_url` | โ | ุจูุงูุงุช ุงููุณุชุฎุฏููู |
| `projects` | `user_id`, `title`, `vfs_data` (JSON), `preview_html` | โ | ุงููุดุงุฑูุน + VFS |
| `chat_messages` | `project_id`, `user_id`, `role`, `content` | โ | ุณุฌู ุงููุญุงุฏุซุงุช |
| `brand_profiles` | `user_id`, `brand_name`, `primary_color`, `logo_url` | โ | ุงูุนูุงูุฉ ุงูุชุฌุงุฑูุฉ |
| `user_usage` | `user_id`, `usage_date`, `builder_calls`, `planner_calls`, `reviewer_calls` | โ | ุชุชุจุน ุงูุงุณุชุฎุฏุงู |

### ุงูุฏูุงู (Functions):
- `check_and_increment_usage(p_user_id, p_function_type, p_daily_limit)` โ `boolean`
  - ูุญุต ุฐุฑู: ุฅุฐุง ุงูุงุณุชุฎุฏุงู < ุงูุญุฏ โ ูุฒูุฏ ุงูุนุฏุงุฏ ููุฑุฌุน `true`
  - ูุฅูุง โ ูุฑุฌุน `false`

---

## ๐ ูููู ุงููุดุฑูุน ุงููุงูู

```
src/
โโโ assets/
โ   โโโ logo-light.jpg           # ุดุนุงุฑ BARQ Ai
โ   โโโ logo-light-full.png      # ุดุนุงุฑ ูุงูู
โโโ components/
โ   โโโ ui/                      # 40+ ูููู Shadcn/UI
โ   โโโ v2/
โ   โ   โโโ PreviewErrorBoundary.tsx  # ุงูุชูุงุท ุฃุฎุทุงุก ุงููุนุงููุฉ
โ   โ   โโโ PreviewPanel.tsx         # ููุญุฉ ุงููุนุงููุฉ
โ   โโโ ThinkingEngine.tsx       # ุนุฑุถ ุฎุท ุงูุฃูุจูุจ ุงููุชุญุฑู
โ   โโโ ChatPage.tsx             # ูุงุฌูุฉ ุงููุญุงุฏุซุฉ
โ   โโโ ChatSidebar.tsx          # ุงูุดุฑูุท ุงูุฌุงูุจู
โ   โโโ MobilePreview.tsx        # ูุนุงููุฉ ุงูุฌูุงู
โ   โโโ AppSidebar.tsx           # ุงูุดุฑูุท ุงูุฌุงูุจู ุงูุฑุฆูุณู
โ   โโโ BarqLogo.tsx             # ูููู ุงูุดุนุงุฑ
โ   โโโ GitHubExportModal.tsx    # ูุงูุฐุฉ ุชุตุฏูุฑ GitHub
โ   โโโ ActivityLog.tsx          # ุณุฌู ุงููุดุงุท
โ   โโโ NavLink.tsx              # ุฑุงุจุท ุงูุชููู
โโโ hooks/
โ   โโโ v2/
โ   โ   โโโ useBuildEngine.ts    # ุงููุญุฑู ุงูุฑุฆูุณู (455 ุณุทุฑ)
โ   โ   โ   โโโ handleSendMessage()   # Phase 1: ุงูุชุฎุทูุท
โ   โ   โ   โโโ handleStartBuild()    # Phase 2: ุงูุชูููุฐ + ุงููุฑุงุฌุนุฉ
โ   โ   โ   โโโ handleFixError()      # Phase 3: ุงูุฅุตูุงุญ
โ   โ   โ   โโโ handleApplyFix()      # ุชุทุจูู ุงูุฅุตูุงุญ
โ   โ   โ   โโโ handleRejectFix()     # ุฑูุถ ุงูุฅุตูุงุญ
โ   โ   โโโ useBuilderChat.ts    # ุฅุฏุงุฑุฉ ุงููุญุงุฏุซุฉ ูุงูุญุงูุฉ
โ   โ   โโโ useVFS.ts            # ูุธุงู ุงููููุงุช + ุงูุชุงุฑูุฎ
โ   โโโ useBuilderProject.ts     # ุฅุฏุงุฑุฉ ุงููุดุฑูุน
โ   โโโ useGitHubExport.ts       # ุชุตุฏูุฑ GitHub
โ   โโโ use-mobile.tsx           # ูุดู ุงูุฌูุงู
โโโ lib/
โ   โโโ barq-api.ts              # ูุงุฌูุฉ API (311 ุณุทุฑ)
โ   โ   โโโ processSSEStream()        # ูุนุงูุฌ SSE ููุญุฏ
โ   โ   โโโ streamBarqPlanner()       # ุจุซ ุงููุดุฑู
โ   โ   โโโ streamBarqBuilder()       # ุจุซ ุงููุจุฑูุฌ
โ   โ   โโโ reviewBuild()             # ูุฑุงุฌุนุฉ (non-streaming)
โ   โ   โโโ streamBarqFixer()         # ุจุซ ุงููุตูุญ
โ   โ   โโโ githubExportAction()      # ุนูููุงุช GitHub
โ   โโโ preview-builder.ts       # ูุญุฑู ุงููุนุงููุฉ (220 ุณุทุฑ)
โ   โ   โโโ jsxToHTML()               # ุชุญููู JSX โ HTML
โ   โ   โโโ buildPreviewHTML()        # ุชุฌููุน ุงููุนุงููุฉ
โ   โโโ utils.ts                 # cn() helper
โโโ pages/
โ   โโโ BuilderPage.tsx          # ุตูุญุฉ ุงูุจูุงุก ุงูุฑุฆูุณูุฉ
โ   โโโ ProjectsPage.tsx         # ููุญุฉ ุงููุดุงุฑูุน
โ   โโโ ProjectDashboardPage.tsx # ููุญุฉ ุชุญูู ุงููุดุฑูุน
โ   โโโ LandingPage.tsx          # ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ
โ   โโโ AuthPage.tsx             # ุชุณุฌูู ุงูุฏุฎูู
โ   โโโ PricingPage.tsx          # ุงูุฃุณุนุงุฑ ูุงูุจุงูุงุช
โ   โโโ BrandSettingsPage.tsx    # ุฅุนุฏุงุฏุงุช ุงูุนูุงูุฉ ุงูุชุฌุงุฑูุฉ
โ   โโโ PrivacyPage.tsx          # ุณูุงุณุฉ ุงูุฎุตูุตูุฉ
โ   โโโ TermsPage.tsx            # ุงูุดุฑูุท ูุงูุฃุญูุงู
โ   โโโ NotFound.tsx             # ุตูุญุฉ 404
โโโ integrations/
    โโโ supabase/
        โโโ client.ts            # Supabase Client (ุชููุงุฆู)
        โโโ types.ts             # Database Types (ุชููุงุฆู)

supabase/
โโโ functions/
    โโโ barq-planner/index.ts    # ุงููุดุฑู โ 288 ุณุทุฑ
    โโโ barq-chat/index.ts       # ุงููุจุฑูุฌ โ 421 ุณุทุฑ
    โโโ barq-reviewer/index.ts   # ุงููุฑุงุฌุน โ 269 ุณุทุฑ
    โโโ barq-fixer/index.ts      # ุงููุตูุญ โ 271 ุณุทุฑ
    โโโ github-export/index.ts   # ุชุตุฏูุฑ GitHub
```

---

## ๐จ ุงููููุฉ ุงูุจุตุฑูุฉ ููุธุงู ุงูุชุตููู

### Design Tokens (`index.css`):

| Token | Light Mode | Dark Mode |
|-------|-----------|-----------|
| `--background` | `0 0% 100%` (ุฃุจูุถ) | `0 0% 0%` (ุฃุณูุฏ) |
| `--primary` | `205 100% 50%` (ุฃุฒุฑู ููุฑุจุงุฆู) | `205 100% 55%` |
| `--accent` | `45 100% 50%` (ุฐูุจู) | `45 100% 55%` |
| `--barq-electric` | `205 100% 50%` | `205 100% 55%` |
| `--barq-gold` | `45 100% 50%` | `45 100% 55%` |
| `--barq-glow` | `205 100% 60%` | `205 100% 65%` |
| `--barq-surface` | `0 0% 96%` | `0 0% 7%` |
| `--barq-gradient-electric` | `135deg, primary โ 220ยฐ` | โ |
| `--barq-shadow-glow` | `0 0 20px primary/0.15` | `0 0 20px primary/0.3` |

### ุฃููููุดูุงุช ูุฎุตุตุฉ:

| ุงูุงุณู | ุงููุฏุฉ | ุงูุงุณุชุฎุฏุงู |
|-------|------|-----------|
| `pulse-glow` | 2s | ุชููุฌ ุงูุฃุฒุฑุงุฑ ูุงูุฃููููุงุช |
| `lightning-flash` | 1.5s | ูููุถ ุงูุจุฑู |
| `slide-up-fade` | 0.3s | ุธููุฑ ุงูุนูุงุตุฑ ูู ุงูุฃุณูู |
| `typing-dot` | 1.4s | ููุงุท ุงููุชุงุจุฉ ุงููุชุญุฑูุฉ |

### ุงูุฎุทูุท:
- **Cairo** โ ุงูุฎุท ุงูุฃุณุงุณู (Google Fonts)
- ุงูุฃูุฒุงู: 300, 400, 500, 600, 700, 800, 900
- ุงูุงุชุฌุงู: RTL ุจุงููุงูู (`direction: rtl`)

---

## ๐ ุงูุจุฏุก ุงูุณุฑูุน

```bash
# ุชุซุจูุช ุงููุชุทูุจุงุช
npm install

# ุชุดุบูู ุจูุฆุฉ ุงูุชุทููุฑ
npm run dev

# ุจูุงุก ููุฅูุชุงุฌ
npm run build
```

---

## ๐ ุงูุชุฑุฎูุต

ุฌููุน ุงูุญููู ูุญููุธุฉ ยฉ 2025 BARQ Ai

---

<p align="center">
  ุตููุน ุจู โก ูู ุงูุณุนูุฏูุฉ ๐ธ๐ฆ
</p>
